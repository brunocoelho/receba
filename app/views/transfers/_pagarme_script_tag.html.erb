<script>
  $(document).ready(function () {
      PagarMe.encryption_key = "<%= ENV['PAGAR_ME_ENCRYPTION_KEY'] %>";

      var form = $("#new_transfer");

      form.submit(function (event) {
          var creditCard = new PagarMe.creditCard();
          creditCard.fillFromFrom(form);

          var fieldErrors = creditCard.fieldErrors();

          var hasErrors = false;
          for(var field in fieldErrors) { hasErrors = true; break; }

          $("#new_transfer #card_number").css('border', '3px solid green');
          $("#new_transfer #card_holder_name").css('border', '3px solid green');
          $("#new_transfer #card_expiration_month").css('border', '3px solid green');
          $("#new_transfer #card_expiration_year").css('border', '3px solid green');
          $("#new_transfer #card_cvv").css('border', '3px solid green');

          if (hasErrors) {
              for(var fieldName in fieldErrors) {
                  var field = $(form.find("#" + fieldName)[0]);
                  field.css('border', '3px solid red');
              }

              return false;
          }

          creditCard.generateHash(function(cardHash) {
              form.append($('<input type="hidden" name="card_hash"/>').val(cardHash));
              PagarMe.removeCardFieldsFromForm(form);
              form.get(0).submit();
          });

          return false;
      });
  });
</script>